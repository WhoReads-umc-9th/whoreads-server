name: Update Mermaid ERD

on:
  push:
    paths:
      # 이 경로에 있는 파일이 변경될 때만 이 워크플로우가 실행됩니다.
      - 'docs/ERD/WhoReads.sql'
    branches:
      - main  # main 브랜치에 push될 때

jobs:
  generate-erd:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # 결과물(ERD.md)을 리포지토리에 커밋하기 위한 권한

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Run generation script
        # 프로젝트 루트에서 스크립트를 실행합니다.
        # 스크립트 내부에서 경로를 자동으로 찾으므로 별도 설정 불필요
        run: |
          python scripts/sql_to_mermaid.py

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: Update ERD.md due to schema change"
          file_pattern: 'docs/ERD/ERD.md'  # 변경된 ERD.md 파일만 커밋